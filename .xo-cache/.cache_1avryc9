{"/app/helpers.js":{"size":254,"mtime":1500328632955,"hashOfConfig":"hm2zq5","results":{"filePath":"/app/helpers.js","messages":[],"errorCount":0,"warningCount":0}},"/app/db-connect.js":{"size":1246,"mtime":1500333645778,"hashOfConfig":"hm2zq5","results":{"filePath":"/app/db-connect.js","messages":[],"errorCount":0,"warningCount":0,"output":"const mongo = require('mongodb').MongoClient\n\nconst mongoUri = process.env.MONGO_URI\n\nconst connect = (url, res) => {\n  mongo.connect(mongoUri, (err, db) => {\n    if (err) {\n      throw err\n    }\n\n    const collection = db.collection('urls')\n\n    collection.find({_id: 'url info'}).toArray((err, docs) => {\n      if (err) {\n        throw err\n      }\n\n      if (docs.length === 0) {\n        collection.insertMany(\n          [{_id: 'url info', numIds: 0}, {0: url}]\n        ).then(() => {\n          const urlsToSend = {normal: url, shortened: 'https://nickel-value.glitch.me/0'}\n          db.close()\n          res.end(JSON.stringify(urlsToSend))\n        }).catch(err => console.log(err))\n      } else {\n        collection.update(\n          {_id: 'url info'}, {$inc: {numIds: 1}}\n        ).then(() => {\n          const urlId = {}\n          const key = docs[0].numIds + 1\n          urlId[key] = url\n          collection.insert(urlId)\n          return key\n        }).then(key => {\n          const urlToSend = {normal: url, shortened: 'https://nickel-value.glitch.me/' + key}\n          res.end(JSON.stringify(urlToSend))\n          db.close()\n        }).catch(err => console.log('ERR:', err))\n      }\n    })\n  })\n}\n\nmodule.exports = connect\n\n"}}}