{"/app/helpers.js":{"size":291,"mtime":1500780162331,"hashOfConfig":"1gw0m5u","results":{"filePath":"/app/helpers.js","messages":[],"errorCount":0,"warningCount":0,"output":"const validUrl = require('validator')\n\nconst parseUrl = urlParams => {\n   return urlParams.url + urlParams[0]\n}\n\nconst isUrlValid = url => {\n   if (!validUrl.isURL(url) && url.slice(0, 4) === 'http') {\n      return false\n   }\n   return true\n}\n\nmodule.exports = {\n   parseUrl,\n   isUrlValid\n}\n"}},"/app/db-helpers.js":{"size":1641,"mtime":1500779308272,"hashOfConfig":"1gw0m5u","results":{"filePath":"/app/db-helpers.js","messages":[],"errorCount":0,"warningCount":0,"output":"const mongo = require('mongodb').MongoClient\n\nconst mongoUri = process.env.MONGO_URI\nconst shortUrl = process.env.SHORT_URL\n\nconst getUrl = (urlId, res) => {\n   mongo.connect(mongoUri, (err, db) => {\n      if (err) {\n         throw err\n      }\n      const collection = db.collection('urls')\n      collection.findOne(\n      {_id: parseInt(urlId, 10)}\n    ).then(doc => {\n       db.close()\n       res.redirect(doc.url)\n    }).catch(err => console.log(err))\n   })\n}\n\nconst connect = (url, res) => {\n   mongo.connect(mongoUri, (err, db) => {\n      if (err) {\n         throw err\n      }\n\n      const collection = db.collection('urls')\n      collection.find({_id: 'url info'}).toArray((err, docs) => {\n         if (err) {\n            throw err\n         }\n\n         if (docs.length === 0) {\n            collection.insertMany(\n               [{_id: 'url info', numIds: 0}, {_id: 0, url}]\n            ).then(() => {\n               const urlsToSend = {normal: url, shortened: shortUrl + '0'}\n               db.close()\n               res.end(JSON.stringify(urlsToSend))\n            }).catch(err => console.log(err))\n         } else {\n            collection.update(\n               {_id: 'url info'}, {$inc: {numIds: 1}}\n            ).then(() => {\n               const urlId = docs[0].numIds + 1\n               collection.insert({_id: urlId, url})\n               return urlId\n            }).then(urlId => {\n               const urlToSend = {normal: url, shortened: shortUrl + urlId}\n               res.end(JSON.stringify(urlToSend))\n               db.close()\n            }).catch(err => console.log(err))\n         }\n      })\n   })\n}\n\nmodule.exports = {\n   connect,\n   getUrl\n}\n"}}}